<div class="expense-detail-container">
  <div class="summary-card-row">
    <div class="summary-card">
      <h4>Total Spend This Month</h4>
      <p>{{ expenseSummary?.totalSpendThisMonth | currency:'INR' }}</p>
    </div>
    <div class="summary-card">
      <h4>Average Daily Spend</h4>
      <p>{{ expenseSummary?.averageDailySpend | currency:'INR' }}</p>
    </div>
    <div class="summary-card">
      <h4>Highest Spending Category</h4>
      <p>{{ expenseSummary?.highestSpendingCategory || 'N/A' }}</p>
    </div>
  </div>

  <div class="charts-row">
    <div class="bento-card top-categories">
      <h3>Top Categories</h3>
      <app-top-categories [categories]="expenseByCategory"></app-top-categories>
    </div>
    <div class="bento-card chart-container">
      <div class="main-chart">
        <div class="chart-switcher">
          <button (click)="selectChartType('pie')" [class.active]="selectedChartType === 'pie'">Pie</button>
          <button (click)="selectChartType('bar')" [class.active]="selectedChartType === 'bar'">Bar</button>
        </div>
        @if(selectedChartType === 'pie') {
          <app-pie-chart [data]="expenseByCategory" (categoryClicked)="onCategorySelected($event)"></app-pie-chart>
        } @else {
          <app-bar-chart [data]="expenseByCategory" [label]="'Expenses'"
                         (categoryClicked)="onCategorySelected($event)"></app-bar-chart>
        }
      </div>
      <div class="category-details">
        <h4>Category Details</h4>
        @if(selectedExpenseCategorySummary) {
          <div class="details-content active">
            <span class="category-name">{{ selectedExpenseCategorySummary.highestSpendingCategory }}</span>
            <div class="details-row">
              <span>Total Spend:</span>
              <span class="amount">{{ selectedExpenseCategorySummary.totalSpendThisMonth | currency:'INR' }}</span>
            </div>
            <div class="details-row">
              <span>Avg Transaction:</span>
              <span class="amount">{{ selectedExpenseCategorySummary.averageDailySpend | currency:'INR' }}</span>
            </div>
          </div>
        } @else {
          <div class="details-prompt">
            <p>Click a category on a chart for more details.</p>
          </div>
        }
      </div>
    </div>
  </div>


  <div class="trend-row">
    <div class="bento-card category-selector">
      <div class="trend-header">
        <h3>Daily Spending by Category</h3>
        <input type="month" id="month-select" [(ngModel)]="selectedMonth" (change)="updateMonthlyTrendChart()">
      </div>
      <div class="category-list">
        @for(category of allCategories; track category) {
          <div class="category-item">
            <input type="checkbox" [id]="category" [checked]="selectedCategories[category]"
                   (change)="toggleCategory(category)">
            <label [for]="category">{{ category }}</label>
          </div>
        }
      </div>
    </div>
    <div class="bento-card line-chart-container">
      <app-line-chart [data]="monthlyTrendData"></app-line-chart>
    </div>
  </div>
</div>
